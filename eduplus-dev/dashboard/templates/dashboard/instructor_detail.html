{% extends 'base.html' %}
{% load static %}

{% block title %}Détails de l'instructeur | EduPlus{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-3">
            <div class="dashboard-sidebar">
                <a href="{% url 'dashboard:admin' %}" class="sidebar-link">
                    <i class="fas fa-tachometer-alt"></i> Tableau de bord
                </a>
                <a href="{% url 'dashboard:users' %}" class="sidebar-link">
                    <i class="fas fa-users"></i> Utilisateurs
                </a>
                <a href="{% url 'dashboard:courses_management' %}" class="sidebar-link">
                    <i class="fas fa-chalkboard"></i> Cours
                </a>
                <a href="{% url 'dashboard:instructors' %}" class="sidebar-link active">
                    <i class="fas fa-chalkboard-teacher"></i> Instructeurs
                </a>
                <a href="{% url 'dashboard:students' %}" class="sidebar-link">
                    <i class="fas fa-user-graduate"></i> Étudiants
                </a>
                <a href="{% url 'dashboard:transactions' %}" class="sidebar-link">
                    <i class="fas fa-money-bill-wave"></i> Transactions
                </a>
                <a href="{% url 'dashboard:reports_management' %}" class="sidebar-link">
                    <i class="fas fa-chart-line"></i> Rapports
                </a>
                <a href="{% url 'dashboard:settings' %}" class="sidebar-link">
                    <i class="fas fa-cog"></i> Paramètres
                </a>
                <a href="{% url 'dashboard:reports' %}" class="sidebar-link">
                    <i class="fas fa-file-alt"></i> Rapports du site
                </a>
                <a href="{% url 'dashboard:notifications' %}" class="sidebar-link">
                    <i class="fas fa-bell"></i> Notifications
                </a>
            </div>
        </div>
        
        <!-- Contenu principal -->
        <div class="col-lg-9">
            <div class="dashboard-header mb-4">
                <div class="d-flex justify-content-between align-items-center flex-wrap">
                    <div>
                        <h2 class="h3 mb-0">Détails de l'instructeur</h2>
                        <p class="text-muted">Voir et gérer les informations de l'instructeur</p>
                    </div>
                    <div class="d-flex">
                        <a href="{% url 'dashboard:instructors' %}" class="btn btn-outline-secondary me-2">
                            <i class="fas fa-arrow-left me-1"></i> Retour
                        </a>
                        <a href="{% url 'dashboard:instructor_edit' instructor.id %}" class="btn btn-primary me-2">
                            <i class="fas fa-edit me-1"></i> Modifier
                        </a>
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteInstructorModal">
                            <i class="fas fa-trash me-1"></i> Supprimer
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Informations de l'instructeur -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card mb-4">
                        <div class="card-body text-center">
                            {% if instructor.profile.profile_picture %}
                                <img src="{{ instructor.profile.profile_picture.url }}" alt="{{ instructor.username }}" class="img-fluid rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                            {% else %}
                                <img src="{% static 'img/default-user.png' %}" alt="{{ instructor.username }}" class="img-fluid rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                            {% endif %}
                            <h4 class="mb-1">{{ instructor.get_full_name|default:instructor.username }}</h4>
                            <p class="text-muted mb-3">{{ instructor.email }}</p>
                            <span class="badge bg-success mb-3">Instructeur</span>
                            {% if instructor.is_active %}
                                <span class="badge bg-success mb-3">Actif</span>
                            {% else %}
                                <span class="badge bg-danger mb-3">Inactif</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">Statistiques</h5>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between mb-3">
                                <span>Cours enseignés:</span>
                                <span class="fw-bold">{{ courses_taught.count }}</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span>Étudiants inscrits:</span>
                                <span class="fw-bold">{{ students_count }}</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span>Revenus générés:</span>
                                <span class="fw-bold">{{ revenue }} €</span>
                            </div>
                            <div class="d-flex justify-content-between mb-0">
                                <span>Date d'inscription:</span>
                                <span class="fw-bold">{{ instructor.date_joined|date:"d/m/Y" }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-8">
                    <div class="card mb-4">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">Informations personnelles</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <span class="text-muted">Nom complet:</span>
                                <p class="mb-0">{{ instructor.get_full_name|default:"Non renseigné" }}</p>
                            </div>
                            <div class="mb-3">
                                <span class="text-muted">Nom d'utilisateur:</span>
                                <p class="mb-0">{{ instructor.username }}</p>
                            </div>
                            <div class="mb-3">
                                <span class="text-muted">Email:</span>
                                <p class="mb-0">{{ instructor.email }}</p>
                            </div>
                            <div class="mb-0">
                                <span class="text-muted">Biographie:</span>
                                <p class="mb-0">{{ instructor.bio|default:"Aucune biographie disponible." }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cours enseignés -->
                    <div class="card">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Cours enseignés</h5>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col">Titre</th>
                                        <th scope="col">Catégorie</th>
                                        <th scope="col">Prix</th>
                                        <th scope="col">Étudiants</th>
                                        <th scope="col">Statut</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for course in courses_taught %}
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                {% if course.image %}
                                                    <img src="{{ course.image.url }}" alt="{{ course.title }}" class="me-2" style="width: 40px; height: 40px; object-fit: cover;">
                                                {% else %}
                                                    <img src="{% static 'img/default-course.png' %}" alt="{{ course.title }}" class="me-2" style="width: 40px; height: 40px; object-fit: cover;">
                                                {% endif %}
                                                <div>
                                                    <a href="{% url 'courses:course_detail' course.slug %}" class="text-decoration-none">{{ course.title }}</a>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{{ course.category.name }}</td>
                                        <td>{{ course.price }} €</td>
                                        <td>{{ course.enrolled_students.count }}</td>
                                        <td>
                                            {% if course.is_published %}
                                                <span class="badge bg-success">Publié</span>
                                            {% else %}
                                                <span class="badge bg-warning">Brouillon</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="5" class="text-center py-3">
                                            <p class="text-muted mb-0">Aucun cours enseigné</p>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmation de suppression -->
<div class="modal fade" id="deleteInstructorModal" tabindex="-1" aria-labelledby="deleteInstructorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteInstructorModalLabel">Confirmer la suppression</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Êtes-vous sûr de vouloir supprimer l'instructeur <strong>{{ instructor.get_full_name|default:instructor.username }}</strong> ?</p>
                <p class="text-danger">Cette action est irréversible et supprimera toutes les données associées à cet instructeur.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <form action="{% url 'dashboard:instructor_delete' instructor.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Supprimer</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %} 